<html> 
<head> 
<link rel="stylesheet" type="text/css" href="style/dashboard.css">
<script src="src/jquery.js" type="text/javascript"></script>
<script src="src/underscore-min.js" type="text/javascript"></script>
<script src="src/jquery.tmpl.min.js" type="text/javascript"></script>
<script src="src/jquery.isotope.min.js" type="text/javascript"></script>
<script>
$(document).ready(function(){
	console.log('hi');
	$.template( "tabTemplate", $('#tabTemplate'));



	
	chrome.extension.sendRequest({
		type : 'get open tabs'
	},function(response) {
		$.each(response.tabs, function(i, item){
			//$('#main').append('<li>'+item.title+'<p>'+item.text+'</p></li>')
			$.tmpl( "tabTemplate", item ).data('tab',item).appendTo( "#main" )
			console.log(i, item);			
		});
		var $container = $('#main');
		$container.isotope({        
			itemSelector: '.tab'      
		});          		
	});
	
	$("#main").delegate(".tab", "click", function(){
		console.log('Focus on:',$(this).data('tab'));
		chrome.extension.sendRequest({
			type : 'focus on',
			tab : $(this).data('tab')
		},function(response) {		
			console.log(response);
		})
	});
	
	$('#button').click(function(){
		$('#tabs').html('');
		console.log('Buscando')
		chrome.extension.sendRequest({
			type  : 'search in tabs',
			query : $('#search').val()
		},function(response) {
/*		
			$.each(response.tabs, function(i, item){
				$('#tabs').append('<li>'+item.title+'</li>')
				console.log(i, item);
			});
*/
//
			$.each(response.tabs, function(i, item){
				//$('#main').append('<li>'+item.title+'<p>'+item.text+'</p></li>')
				$.tmpl( "tabTemplate", item ).data('tab',item).appendTo( "#main" )
				console.log(i, item);			
			});
			var $container = $('#main');
			$container.isotope({        
				itemSelector: '.tab'      
			});
//			
			
		});		
	})
});
</script>
</head>
<body>
	<nav>
		<h2>There is no place like</h2>
		<h1>{127.0.0.1}</h1>
<!--		
		<p><input id="search"/></p>
		<p><button id="button" >Buscar</button></p>
		<ul id="tabs"></ul>
		<p>Tabs Abiertas</p>
		<ul id="openTabs"></ul>
!-->		
	</nav>
	<section id="main"></section>
</body>
<script id="tabTemplate" text="">
	<article class="tab">
		<h4>
			{{if favIconUrl}}<img class="favicon" src="${favIconUrl}">{{/if}}
			${title}
		</h4>
	</article>
</script>
<html>
